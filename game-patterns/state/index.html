<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>State - game design pattern</title>
</head>
<body>
    <script>
        function HeroineState(handleInput, update, enter) {
            this.handleInput = handleInput || function () {};
            this.enter = enter || function () {};
            this.update = update || function () {};
        }
        HeroineState.standing = function DuckingState() {
            return new HeroineState(function (heroine, input) {
                if (input == 'ArrowDown') {
                    return HeroineState.ducking;
                }
            }, function () {

            }, function (heroine) {
                heroine.setGraphics('IMAGE_STAND');
            })
        }();
        HeroineState.ducking = function DuckingState() {
            var chargeTime = 0;
            var MAX_CHARGE = 1000;
            return new HeroineState(function (heroine, input) {
                chargeTime = 0;
                if (input == 'ArrowDown') {
                    return;
                }
                return HeroineState.standing;
            }, function (heroine) {
                chargeTime++;
                if (chargeTime > MAX_CHARGE)
                {
                    heroine.superBomb();
                }
            }, function (heroine) {
                heroine.setGraphics('IMAGE_DUCK');
            })
        }();
        function Heroine() {
            var obj = this;
            var state = HeroineState.standing;
            obj.handleInput = function(input) {
                var newState = state.handleInput(obj, input);
                if (newState) {
                    state = newState;
                    state.enter(obj);
                }
            };
            obj.update = function(input) {
                state.update(input);
            };
            obj.setGraphics = function (newImage) {
                console.log('NEW IMAGE', newImage);
            };
            obj.superBomb = function () {
                console.log('SUPER BOMB');
            };
        }
        var hero = new Heroine();
        document.addEventListener('keydown', function (e) {
            hero.handleInput(e.code);
        });
        document.addEventListener('keyup', function () {
            hero.handleInput();
        });

    </script>
</body>
</html>